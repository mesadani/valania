{% extends 'base.html' %}

{% block content %}
<div class="races-menu">
    {% for race in races %}
    <div class="race-item" onclick="filterByRace('{{ race.id }}')">
        <img src="{{ race.image.url }}" alt="{{ race.name }}" class="race-image">
        <span>{{ race.name }}</span>
    </div>
    {% endfor %}
</div>

<div class="heroes-container">
    {% for heroe in heroes %}
    <div class="hero-card" data-race-id="{{ heroe.race.id }}" onclick="toggleCard(this)">
        <img src="{{ heroe.image.url }}" alt="{{ heroe.name }}" class="hero-image">
        <div class="hero-info">
            <h2>{{ heroe.name }}</h2>
            <div class="hero-details">
                <p><strong>Type:</strong> {{ heroe.type.name }}</p>
                <p><strong>Race:</strong> {{ heroe.race.name }}</p>
                <p><strong>Supply:</strong> {{ heroe.supply }}</p>
                <p><strong>Rarity:</strong> {{ heroe.rarity.name }}</p>
                <p><strong>Price:</strong> {{ heroe.price }}</p>
                <p><strong>Location:</strong> {{ heroe.location }}</p>
                <p>{{ heroe.description }}</p>
            </div>
        </div>
    </div>
    {% endfor %}
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
    $(document).ready(function() {
        $('.profession-button').click(function() {
            var professionId = $(this).data('id');
            
            $.ajax({
                url: '/professions/' + professionId + '/',
                method: 'GET',
                dataType: 'json',
                success: function(data) {
                    var html = '<h1>' + data.profession_name + '</h1>';
                    html += '<p>' + data.profession_description + '</p>';
                    html += '<h2>Objetos por Nivel</h2><ul>';
                    
                    data.crafting_details.forEach(function(detail) {
                        html += '<li><strong>Nivel ' + detail.level + ':</strong> ' + detail.crafting_name;
                        html += '<ul>';
                        html += '<li>Cantidad: ' + detail.quantity + '</li>';
                        html += '<li>Probabilidad: ' + detail.probability + '</li>';
                        html += '<li>Tiempo: ' + detail.time + '</li>';
                        html += '<li>Requisitos:<ul>';
                        
                        detail.requirements.forEach(function(req) {
                            html += '<li>' + req.name + ' - Cantidad: ' + req.quantity + '</li>';
                        });
                        
                        html += '</ul></li></ul></li>';
                    });
                    
                    html += '</ul>';
                    
                    $('#profession-details').html(html);
                },
                error: function(xhr, status, error) {
                    console.error('Error al cargar los detalles de la profesi√≥n:', error);
                }
            });
        });
    });
    </script>
    
</div>
{% endblock %}
